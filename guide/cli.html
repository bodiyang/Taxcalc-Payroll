

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Command-line interface &#8212; Taxcalc-Payroll</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'guide/cli';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Policy parameters" href="policy_params.html" />
    <link rel="prev" title="Python interface" href="python_interface.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/ospc-aei.png" class="logo__image only-light" alt="Taxcalc-Payroll - Home"/>
    <script>document.write(`<img src="../_static/ospc-aei.png" class="logo__image only-dark" alt="Taxcalc-Payroll - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Taxcalc-Payroll
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Usage</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../usage/starting.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/overview.html">Structural overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/data.html">Data for Taxcalc-Payroll</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">User guide</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="python_interface.html">Python interface</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Command-line interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="policy_params.html">Policy parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="input_vars.html">Input variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="output_vars.html">Output variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="assumption_params.html">Assumption parameters</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../recipes/index.html">Recipes</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../recipes/recipe1.html">Recipe1: Payroll Tax Calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../recipes/recipe2.html">Recipe2: Employer side Payroll Tax Offset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../recipes/recipe3.html">Recipe3: Comparison of Different Payroll Tax Reforms</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">About</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../about/history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/model_interaction.html">Model Interaction</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../contributing/contributor_guide.html">Contributor guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/pr_workflow.html">Pull request workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/param_naming.html">Policy parameter naming and placing conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/RELEASING.html">Releasing Tax-Caclculator Packages</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">API</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/public_api.html">Taxcalc-Payroll Python API</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/calcfunctions.html">Taxcalc-Payroll CalcFunctions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/calculator.html">Taxcalc-Payroll Calculator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/policy.html">Taxcalc-Payroll Policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/records.html">Taxcalc-Payroll Records</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/taxcalcio.html">Tax-Calculator IO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/calcfunctions.html">Taxcalc-Payroll CalcFunctions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/calculator.html">Taxcalc-Payroll Calculator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/policy.html">Taxcalc-Payroll Policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/records.html">Taxcalc-Payroll Records</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/taxcalcio.html">Tax-Calculator IO</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tax-Calculator use cases</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../use_cases.html">Recorded use cases</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/bodiyang/Taxcalc-Payroll" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/bodiyang/Taxcalc-Payroll/edit/master/docs/guide/cli.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/bodiyang/Taxcalc-Payroll/issues/new?title=Issue%20on%20page%20%2Fguide/cli.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/guide/cli.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Command-line interface</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-tcp-cli">Test <code class="docutils literal notranslate"><span class="pre">tcp</span></code> CLI</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specify-tax-reform">Specify tax reform</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specify-analysis-assumptions">Specify analysis assumptions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specify-filing-units">Specify filing units</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initiate-reform-analysis">Initiate reform analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tabulate-reform-results">Tabulate reform results</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="command-line-interface">
<h1>Command-line interface<a class="headerlink" href="#command-line-interface" title="Permalink to this heading">#</a></h1>
<p>You can use Taxcalc-Payroll on your own computer via a command-line interface (CLI) called <code class="docutils literal notranslate"><span class="pre">tcp</span></code>.
This approach requires the use of a text editor to prepare simple files that are read by <code class="docutils literal notranslate"><span class="pre">tcp</span></code>.
Computer programming knowledge is not required, but this approach to using Taxcalc-Payroll assumes you are willing to work at the command line (Terminal on Mac or Anaconda Prompt on Windows) and to use a text editor (for example, TextEdit on Mac or Notepad on Windows).</p>
<section id="test-tcp-cli">
<h2>Test <code class="docutils literal notranslate"><span class="pre">tcp</span></code> CLI<a class="headerlink" href="#test-tcp-cli" title="Permalink to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">tcp</span></code> CLI is part of the Taxcalc-Payroll <code class="docutils literal notranslate"><span class="pre">taxcalcpayroll</span></code> package you installed on your computer as part of <a class="reference internal" href="../usage/starting.html"><span class="doc">Getting started</span></a>.</p>
<p>To check your installation of <code class="docutils literal notranslate"><span class="pre">tcp</span></code>, enter the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tcp</span> <span class="o">--</span><span class="n">test</span>
</pre></div>
</div>
<p>Expected output (after a number of seconds) is <code class="docutils literal notranslate"><span class="pre">PASSED</span> <span class="pre">TEST</span></code>.
If you get <code class="docutils literal notranslate"><span class="pre">FAILED</span> <span class="pre">TEST</span></code>, something went wrong in the installation process. If the installation test fails, please report your experience by <a class="reference external" href="https://github.com/bodiyang/Taxcalc-Payroll/issues">creating a new issue</a>.</p>
<p>If your installation passes the test, you are ready to begin using <code class="docutils literal notranslate"><span class="pre">tcp</span></code> to analyze tax reforms. Continue reading this section for information about how to do that. But if you want a quick hint about the range of <code class="docutils literal notranslate"><span class="pre">tcp</span></code> capabilities, enter the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tcp</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
<p>The basic idea of <code class="docutils literal notranslate"><span class="pre">tcp</span></code> tax analysis is that each tax reform is specified in a text file using a simple method to describe the details of the reform. Read the next part of this section to see how policy reform files are formatted.</p>
</section>
<section id="specify-tax-reform">
<h2>Specify tax reform<a class="headerlink" href="#specify-tax-reform" title="Permalink to this heading">#</a></h2>
<p>The details of a tax reform are contained in a text file that you write with a text editor. The reform is expressed by specifying which tax policy parameters are changed from their current-law values by the reform. The current-law values of each policy parameter are documented in <span class="xref myst">this section</span> of the guide. The timing and magnitude of these policy parameter changes are written in JSON, a simple and widely-used data-specification language.</p>
<p>For several examples of reform files and the general rules for writing JSON reform files, go to <a class="reference external" href="https://github.com/bodiyang/Taxcalc-Payroll/blob/master/taxcalcpayroll/reforms/README.md">this page</a>.</p>
</section>
<section id="specify-analysis-assumptions">
<h2>Specify analysis assumptions<a class="headerlink" href="#specify-analysis-assumptions" title="Permalink to this heading">#</a></h2>
<p>This part explains how to specify economic assumption files used in static tax analysis. This is an advanced topic, so if you want to start out using the default assumptions (which are documented in <span class="xref myst">this section</span> of the guide), you can skip this part now and come back to read it whenever you want to change the default assumptions. The <span class="xref myst">next part</span> of this section discusses filing-unit input files.</p>
<p>The details of analysis assumptions are contained in a text file that you write with a text editor. The assumptions are expressed by specifying which parameters are changed from their default values. The timing and magnitude of these parameter changes are written in JSON, a simple and widely-used data-specification language.</p>
<p>For examples of assumption files and the general rules for writing JSON assumption files, go to <a class="reference external" href="https://github.com/PSLmodels/Tax-Calculator/blob/master/taxcalc/assumptions/README.md#economic-assumption-files">this page</a>.</p>
</section>
<section id="specify-filing-units">
<h2>Specify filing units<a class="headerlink" href="#specify-filing-units" title="Permalink to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">taxcalcpayroll</span></code> package containing <code class="docutils literal notranslate"><span class="pre">tcp</span></code> does not include an IRS-SOI-PUF-derived microsimulation sample. This is because, unlike Census public-use files, the IRS-SOI Public Use File (PUF) is proprietary. If you or your organization has paid IRS to use the PUF version being by Taxcalc-Payroll, then it may be possible for us to share with you our PUF-derived sample, which we call <code class="docutils literal notranslate"><span class="pre">puf.csv</span></code> even though it contains CPS records that represent non-filers. Otherwise, you have two choices.</p>
<p><strong>First</strong>, you can easily create with a text editor a CSV-formatted file containing several filing units whose experience under your tax reform is of interest to you. Much of the public discussion of tax reforms is of this type: how is this family or that family affected by a reform; how do they fare under different reforms; etc. The test conducted to check the <code class="docutils literal notranslate"><span class="pre">tcp</span></code> installation has left one such file. It is called <code class="docutils literal notranslate"><span class="pre">test.csv</span></code> and contains two filing units with only wage and salary income: a lower income family and a higher income family. You can use this <code class="docutils literal notranslate"><span class="pre">test.csv</span></code> file as <code class="docutils literal notranslate"><span class="pre">tcp</span></code> input to analyze your tax reforms. Before creating your own input files be sure to read the short set of guidelines that appear after this list of two choices. Some people pursue this approach using a statistical pacakge like R or Stata, in which case the <code class="docutils literal notranslate"><span class="pre">tcp</span></code> CLI program can be invoked from within the statistical package. There may be a need (especially on Windows) to <a class="reference external" href="https://github.com/PSLmodels/Tax-Calculator/issues/2273#issuecomment-479572287">add to the system PATH</a> in order to do this.</p>
<p><strong>Second</strong>, the <code class="docutils literal notranslate"><span class="pre">taxcalcpayroll</span></code> does include a freely available microsimulation sample containing only filing units derived from several recent March CPS surveys. For several reasons, the results generated by this <code class="docutils literal notranslate"><span class="pre">cps.csv</span></code> file are substantially different from the results generated by the <code class="docutils literal notranslate"><span class="pre">puf.csv</span></code> file. The <code class="docutils literal notranslate"><span class="pre">cps.csv</span></code> file contains a sample of the population while the <code class="docutils literal notranslate"><span class="pre">puf.csv</span></code> file contains mostly a sample of income tax filers in which high-income filing units are over represented. Also, the <code class="docutils literal notranslate"><span class="pre">cps.csv</span></code> file has many income variables that are missing (and assumed to be zero by Taxcalc-Payroll), which causes an understating of total incomes, especially for those with high incomes. All these differences mean that the aggregate revenue and distributional results generated when using the <code class="docutils literal notranslate"><span class="pre">cps.csv</span></code> file as input to Taxcalc-Payroll can be substantially different from the results generated when using the <code class="docutils literal notranslate"><span class="pre">puf.csv</span></code> file as input. And this is particularly true when analyzing reforms that change the tax treatment of high-income filers.</p>
<p><strong>Input-File-Preparation Guidelines</strong></p>
<p>The <code class="docutils literal notranslate"><span class="pre">tcp</span></code> CLI to Taxcalc-Payroll is flexible enough to read almost any kind of CSV-formatted input data on filing units as long as the variable names correspond to those expected by Taxcalc-Payroll. The only required input variables are <code class="docutils literal notranslate"><span class="pre">RECID</span></code> (a unique filing-unit record identifier) and <code class="docutils literal notranslate"><span class="pre">MARS</span></code> (a positive-valued filing-status indicator). Other variables in the input file must have variable names that are listed in the <span class="xref myst">Input Variables</span> section for them to affect the tax calculations. Any variable listed in Input Variables that is not in an input file is automatically set to zero for every filing unit. Variables in the input file that are not listed in Input Variables are ignored by Taxcalc-Payroll.</p>
<p>However, there are important data-preparation issues related to the fact that the payroll tax is a tax on individuals, not on income-tax filing units. Taxcalc-Payroll expects that the filing-unit total for each of several earnings-related variables is split between the taxpayer and the spouse. It is the responsibility of anyone preparing data for Taxcalc-Payroll input to do this earnings splitting. Here are the relationships between the filing-unit variable and the taxpayer (<code class="docutils literal notranslate"><span class="pre">p</span></code>) and spouse (<code class="docutils literal notranslate"><span class="pre">s</span></code>) variables expected by Taxcalc-Payroll:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">e00200</span> <span class="o">=</span> <span class="n">e00200p</span> <span class="o">+</span> <span class="n">e00200s</span>
<span class="n">e00900</span> <span class="o">=</span> <span class="n">e00900p</span> <span class="o">+</span> <span class="n">e00900s</span>
<span class="n">e02100</span> <span class="o">=</span> <span class="n">e02100p</span> <span class="o">+</span> <span class="n">e02100s</span>
</pre></div>
</div>
<p>Obviously, when <code class="docutils literal notranslate"><span class="pre">MARS</span></code> is not equal to 2 (married filing jointly), the values of the three <code class="docutils literal notranslate"><span class="pre">s</span></code> variables are zero and the value of each <code class="docutils literal notranslate"><span class="pre">p</span></code> variable is equal to the value of its corresponding filing-unit variable. Note that the input file can omit any one, or all, of these three sets variables. If the three variables in one of these sets are omitted, the required relationship will be satisfied because zero equals zero plus zero.</p>
<p>In addition to this earnings-splitting data-preparation issue, Taxcalc-Payroll expects that the value of ordinary dividends (<code class="docutils literal notranslate"><span class="pre">e00600</span></code>) will be no less than the value of qualified dividends (<code class="docutils literal notranslate"><span class="pre">e00650</span></code>) for each filing unit. And it also expects that the value of total pension and annuity income (<code class="docutils literal notranslate"><span class="pre">e01500</span></code>) will be no less than the value of taxable pension and annuity income (<code class="docutils literal notranslate"><span class="pre">e01700</span></code>) for each filing unit. Taxcalc-Payroll also expects the value of the required MARS variable to be in the range from one to five, and the value of the EIC variable to be in the range from zero to three. Again, it is your responsibility to prepare input data for Taxcalc-Payroll in a way that ensures these relationships are true for each filing unit.</p>
<p>Here’s an example of how to specify a few stylized filing units with and without young children:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RECID</span><span class="p">,</span><span class="n">MARS</span><span class="p">,</span><span class="n">XTOT</span><span class="p">,</span><span class="n">EIC</span><span class="p">,</span><span class="n">n24</span><span class="p">,</span><span class="o">...</span>
    <span class="mi">11</span>   <span class="p">,</span>  <span class="mi">1</span> <span class="p">,</span>  <span class="mi">1</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span><span class="o">...</span> <span class="o">&lt;==</span> <span class="n">single</span> <span class="n">person</span> <span class="k">with</span> <span class="n">no</span> <span class="n">kids</span>
    <span class="mi">12</span>   <span class="p">,</span>  <span class="mi">4</span> <span class="p">,</span>  <span class="mi">2</span> <span class="p">,</span> <span class="mi">1</span> <span class="p">,</span> <span class="mi">1</span> <span class="p">,</span><span class="o">...</span> <span class="o">&lt;==</span> <span class="n">single</span> <span class="n">person</span> <span class="k">with</span> <span class="n">a</span> <span class="n">young</span> <span class="n">kid</span>
    <span class="mi">13</span>   <span class="p">,</span>  <span class="mi">2</span> <span class="p">,</span>  <span class="mi">4</span> <span class="p">,</span> <span class="mi">2</span> <span class="p">,</span> <span class="mi">2</span> <span class="p">,</span><span class="o">...</span> <span class="o">&lt;==</span> <span class="n">married</span> <span class="n">couple</span> <span class="k">with</span> <span class="n">two</span> <span class="n">young</span> <span class="n">kids</span>
</pre></div>
</div>
<p>Be sure to read the documentation of the <code class="docutils literal notranslate"><span class="pre">MARS</span></code>, <code class="docutils literal notranslate"><span class="pre">XTOT</span></code>, <code class="docutils literal notranslate"><span class="pre">EIC</span></code>, and <code class="docutils literal notranslate"><span class="pre">n24</span></code> input variables. Also, there may be a need to add other child-age input variables if you want to simulate reforms like a child credit bonus for young children. Also, the universal basic income (UBI) reform is implemented using its own set of three age-group-count input variables.</p>
<p>The name of your input data file is also relevant to how <code class="docutils literal notranslate"><span class="pre">tcp</span></code> will behave. If your file name ends with “puf.csv” or “cps.csv”, <code class="docutils literal notranslate"><span class="pre">tcp</span></code> will automatically extrapolate your data from its base year to the year you specify for tax calculations to be calculated using built in growth factors, extrapolated weights, and other adjustment factors. If you are not using the “puf.csv” or “cps.csv” files produced by the TaxData project, it is likely that your data will not be compatible with these extrapolations and you should adopt filenames with alternative endings.</p>
</section>
<section id="initiate-reform-analysis">
<h2>Initiate reform analysis<a class="headerlink" href="#initiate-reform-analysis" title="Permalink to this heading">#</a></h2>
<p>Executing <code class="docutils literal notranslate"><span class="pre">tcp</span></code> requires only two command-line arguments: the name of an input file containing one or more filing units and the year for which the tax calculations are done. A baseline policy file is optional; specifying no baseline file implies the baseline policy is current-law policy. A policy reform file is optional; specifying no reform file implies calculations are done for the baseline policy. An economic assumption file is also optional; no assumption file implies you want to use the default values of the assumption parameters. The output files written by <code class="docutils literal notranslate"><span class="pre">tcp</span></code> are built-up from the name of the input file, tax year, baseline file, reform file, and assumption file using a <code class="docutils literal notranslate"><span class="pre">#</span></code> character if an option is not specified.</p>
<p>Here we explain how to conduct tax analysis with <code class="docutils literal notranslate"><span class="pre">tcp</span></code> by presenting a series of examples and explaining what output is produced in each example. There are several types of output that <code class="docutils literal notranslate"><span class="pre">tcp</span></code> can generate so there will be more than a few examples. The examples are numbered in order to make it easier to refer to different examples. All the examples assume that the input file is <code class="docutils literal notranslate"><span class="pre">test.csv</span></code>, which was mentioned earlier in this guide.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tcp</span> <span class="n">test</span><span class="o">.</span><span class="n">csv</span> <span class="mi">2020</span>
</pre></div>
</div>
<p>This produces a minimal output file containing 2020 tax liabilities for each filing unit assuming the income amounts in the input file are amounts for 2020 and assuming current-law tax policy projected to 2020. The name of the CSV-formatted output file is <code class="docutils literal notranslate"><span class="pre">test-20-#-#-#.csv</span></code>. The first <code class="docutils literal notranslate"><span class="pre">#</span></code> symbol indicates we did not specify a baseline file and the second <code class="docutils literal notranslate"><span class="pre">#</span></code> symbol indicates we did not specify a policy reform file and the third <code class="docutils literal notranslate"><span class="pre">#</span></code> symbol indicates we did not specify an economic assumption file.<br />
The variables included in the minimal output file include: <code class="docutils literal notranslate"><span class="pre">RECID</span></code> (of filing unit in the input file), <code class="docutils literal notranslate"><span class="pre">YEAR</span></code> (specified when executing <code class="docutils literal notranslate"><span class="pre">tcp</span></code>), <code class="docutils literal notranslate"><span class="pre">WEIGHT</span></code> (which is same as <code class="docutils literal notranslate"><span class="pre">s006</span></code>), <code class="docutils literal notranslate"><span class="pre">INCTAX</span></code> (which is same as <code class="docutils literal notranslate"><span class="pre">iitax</span></code>), <code class="docutils literal notranslate"><span class="pre">LSTAX</span></code> (which is same as <code class="docutils literal notranslate"><span class="pre">lumpsum_tax</span></code>) and <code class="docutils literal notranslate"><span class="pre">PAYTAX</span></code> (which is same as <code class="docutils literal notranslate"><span class="pre">payroll_tax</span></code>).</p>
<p>Also, documentation of the reform is always written to a text file ending in <code class="docutils literal notranslate"><span class="pre">-doc.text</span></code>, which in this example would be named <code class="docutils literal notranslate"><span class="pre">test-20-#-#-#-doc.text</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tcp</span> <span class="n">test</span><span class="o">.</span><span class="n">csv</span> <span class="mi">2020</span> <span class="o">--</span><span class="n">dump</span>
</pre></div>
</div>
<p>This produces a much more complete output file with the same name <code class="docutils literal notranslate"><span class="pre">test-20-#-#-#.csv</span></code> as the minimal output file produced in example (1). No other output is generated other than the <code class="docutils literal notranslate"><span class="pre">test-20-#-#-#-doc.text</span></code> file. The <code class="docutils literal notranslate"><span class="pre">--dump</span></code> option causes <strong>all</strong> the input variables (including the ones understood by Taxcalc-Payroll but not included in <code class="docutils literal notranslate"><span class="pre">test.csv</span></code>, which are all zero) and <strong>all</strong> the output variables calculated by Taxcalc-Payroll to be included in the output file. For a complete list of input variables, see the <span class="xref myst">Input Variables</span> section. For a complete list of output variables, see the <span class="xref myst">Output Variables</span> section. Since Taxcalc-Payroll ignores variables in the input file that are not in the Input Variables section, the dump output file in example (2) can be used as an input file and it will produce exactly the same tax liabilities (apart from rounding errors of one or two cents) as in the original dump output.</p>
<p>This full dump output can be useful for debugging and is small when using just a few filing units as input. But when using large samples as input (for example, the <code class="docutils literal notranslate"><span class="pre">cps.csv</span></code> input file), the size of the dump output becomes quite large. There is a way to specify a <strong>partial dump</strong> that includes only variables of interest. To have <code class="docutils literal notranslate"><span class="pre">tcp</span></code> do a partial dump, create a text file that lists the names of the variables to be included in the partial dump. You can put the varible names on separate lines and/or put several names on one line separated by spaces. Then point to that file using the <code class="docutils literal notranslate"><span class="pre">--dvars</span></code> option. So, for example, if your list of dump variables is in a file named <code class="docutils literal notranslate"><span class="pre">mydumpvars</span></code>, a partial dump file is created this way:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tcp</span> <span class="n">cps</span><span class="o">.</span><span class="n">csv</span> <span class="mi">2020</span> <span class="o">--</span><span class="n">dump</span> <span class="o">--</span><span class="n">dvars</span> <span class="n">mydumpvars</span>
</pre></div>
</div>
<p>If there is no <code class="docutils literal notranslate"><span class="pre">--dvars</span></code> option, the <code class="docutils literal notranslate"><span class="pre">--dump</span></code> option produces a full dump.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tcp</span> <span class="n">test</span><span class="o">.</span><span class="n">csv</span> <span class="mi">2020</span> <span class="o">--</span><span class="n">sqldb</span>
</pre></div>
</div>
<p>This produces the same dump output as example (2) except that the dump output is written not to a CSV-formatted file, but to the dump table in an SQLite3 database file, which is called <code class="docutils literal notranslate"><span class="pre">test-20-#-#-#.db</span></code> in this example. Because the <code class="docutils literal notranslate"><span class="pre">--dump</span></code> option is not used in example (3), minimal output will be written to the <code class="docutils literal notranslate"><span class="pre">test-20-#-#-#.csv</span></code> file. Note that use of the <code class="docutils literal notranslate"><span class="pre">--dvars</span></code> option causes the contents of the database file to be a partial dump.</p>
<p>Pros and cons of putting dump output in a CSV file or an SQLite3 database table: The CSV file is almost twice as large as the database, but it can be easily imported into a wide range of statistical packages. The main advantage of the SQLite3 database is that the Anaconda Python distribution includes <a class="reference external" href="https://www.sqlite.org/cli.html">sqlite3</a> (or sqlite3.exe on Windows), a command-line tool that can be used to tabulate dump output using structured query language (SQL). SQL is a language that you use to specify the tabulation you want and the SQL database figures out the procedure for generating your tabulation and then executes that procedure; there is no computer programming involved. We illustrate SQL tabulation of dump output in a <span class="xref myst">subsequent section</span>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tcp</span> <span class="n">test</span><span class="o">.</span><span class="n">csv</span> <span class="mi">2020</span> <span class="o">--</span><span class="n">dump</span> <span class="o">--</span><span class="n">sqldb</span>
</pre></div>
</div>
<p>This shows that you can get dump output in the two different formats from a single <code class="docutils literal notranslate"><span class="pre">tcp</span></code> run.</p>
<p>The remaining examples use neither the <code class="docutils literal notranslate"><span class="pre">--dump</span></code> nor the <code class="docutils literal notranslate"><span class="pre">--sqldb</span></code> option, and thus, produce minimal output for the reform. But either or both of those options could be used in all the subsequent examples to generate more complete output for the reform.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tcp</span> <span class="n">test</span><span class="o">.</span><span class="n">csv</span> <span class="mi">2021</span> <span class="o">--</span><span class="n">reform</span> <span class="n">ref3</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>This produces 2021 output for the filing units in the <code class="docutils literal notranslate"><span class="pre">test.csv</span></code> file using the policy reform specified in the <code class="docutils literal notranslate"><span class="pre">ref3.json</span></code> file. The name of the output file in this example is <code class="docutils literal notranslate"><span class="pre">test-21-#-ref3-#.csv</span></code> because no baseline or assumption options were specified.</p>
<p>If, in addition to <code class="docutils literal notranslate"><span class="pre">ref3.json</span></code>, there was a <code class="docutils literal notranslate"><span class="pre">ref4.json</span></code> reform file and analysis of the <strong>compound reform</strong> (consisting of first implementing the <code class="docutils literal notranslate"><span class="pre">ref3.json</span></code> reform relative to current-law policy and then implementing the <code class="docutils literal notranslate"><span class="pre">ref4.json</span></code> reform relative to the <code class="docutils literal notranslate"><span class="pre">ref3.json</span></code> reform) is desired, both reform files can be mentioned in the <code class="docutils literal notranslate"><span class="pre">--reform</span></code> option as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tcp</span> <span class="n">test</span><span class="o">.</span><span class="n">csv</span> <span class="mi">2021</span> <span class="o">--</span><span class="n">reform</span> <span class="n">ref3</span><span class="o">.</span><span class="n">json</span><span class="o">+</span><span class="n">ref4</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>The above command generates an output file named <code class="docutils literal notranslate"><span class="pre">test-21-#-ref3+ref4-#.csv</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tcp</span> <span class="n">test</span><span class="o">.</span><span class="n">csv</span> <span class="mi">2021</span> <span class="o">--</span><span class="n">reform</span> <span class="n">ref3</span><span class="o">.</span><span class="n">json</span> <span class="o">--</span><span class="n">assump</span> <span class="n">res1</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>This produces 2021 output for the filing units in the <code class="docutils literal notranslate"><span class="pre">test.csv</span></code> file using the policy reform specified in the <code class="docutils literal notranslate"><span class="pre">ref3.json</span></code> file and the economic assumptions specified in the <code class="docutils literal notranslate"><span class="pre">eas1.json</span></code> file. The output results produced by this analysis are written to the <code class="docutils literal notranslate"><span class="pre">test-21-#-ref3-eas1.csv</span></code> file.</p>
<p>In the preceding examples, all the output files are written in the directory where the <code class="docutils literal notranslate"><span class="pre">tcp</span></code> command was executed. If you want the output files to be written in a different directory, use the <code class="docutils literal notranslate"><span class="pre">--outdir</span></code> option. So, for example, if you have created the <code class="docutils literal notranslate"><span class="pre">myoutput</span></code> directory as a subdirectory of the directory from where you are running <code class="docutils literal notranslate"><span class="pre">tcp</span></code>, output files will be written there if you use the <code class="docutils literal notranslate"><span class="pre">--outdir</span> <span class="pre">myoutput</span></code> option.</p>
<p>The following examples illustrate output options that work only if each filing unit in the input file has a positive sampling weight (<code class="docutils literal notranslate"><span class="pre">s006</span></code>). So, we are going to use the <code class="docutils literal notranslate"><span class="pre">cps.csv</span></code> file in these examples along with the policy reform specified in the <code class="docutils literal notranslate"><span class="pre">ref3.json</span></code> file, the content of which is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">ref3</span><span class="o">.</span><span class="n">json</span> <span class="n">raises</span> <span class="n">personal</span> <span class="n">exemption</span> <span class="n">amount</span> <span class="n">to</span> <span class="mi">8000</span> <span class="ow">in</span> <span class="mi">2022</span><span class="p">,</span>
<span class="o">//</span> <span class="n">after</span> <span class="n">which</span> <span class="n">it</span> <span class="n">continues</span> <span class="n">to</span> <span class="n">be</span> <span class="n">indexed</span> <span class="n">to</span> <span class="n">price</span> <span class="n">inflation</span><span class="o">.</span>
<span class="p">{</span>
    <span class="s2">&quot;II_em&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;2022&quot;</span><span class="p">:</span> <span class="mi">8000</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The output options illustrated in the following examples generate tables of the post-reform level and the reform-induced change in tax liability by income deciles as well as graphs of marginal and average tax rates and percentage change in aftertax income by income percentiles. These tables and graphs are meant to provide a quick glance at the impact of a reform. Any serious analysis of a reform will involve generating custom tables and graphs using <span class="xref myst">partial dump</span> output. One of many examples of this sort of custom analysis is <a class="reference external" href="https://www.washingtonpost.com/graphics/2017/business/tax-bill-calculator/?">here</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcp cps.csv 2022 --reform ref3.json --tables
You loaded data for 2014.
Taxcalc-Payroll startup automatically extrapolated your data to 2022.

ls cps-22*
cps-22-#-ref3-#-doc.text    cps-22-#-ref3-#.csv
cps-22-#-ref3-#-tab.text

$ cat cps-22-#-ref3-#-tab.text
Weighted Tax Reform Totals by Baseline Expanded-Income Decile
    Returns    ExpInc    IncTax    PayTax     LSTax    AllTax
       (#m)      ($b)      ($b)      ($b)      ($b)      ($b)
 0    17.19     195.6      -6.1      20.9       0.0      14.8
 1    17.19     500.1      -7.9      44.1       0.0      36.2
 2    17.19     664.2      -2.7      51.7       0.0      49.0
 3    17.19     829.5       1.3      68.5       0.0      69.8
 4    17.19    1030.5       7.8      86.7       0.0      94.5
 5    17.19    1273.3      16.7     103.9       0.0     120.6
 6    17.19    1596.8      40.7     137.6       0.0     178.4
 7    17.19    2044.5      81.4     183.3       0.0     264.7
 8    17.19    2821.3     177.0     263.2       0.0     440.2
 9    17.19    6369.3    1025.5     476.3       0.0    1501.8
 A   171.93   17325.2    1333.8    1436.2       0.0    2770.0

Weighted Tax Differences by Baseline Expanded-Income Decile
    Returns    ExpInc    IncTax    PayTax     LSTax    AllTax
       (#m)      ($b)      ($b)      ($b)      ($b)      ($b)
 0    17.19     195.6      -1.8       0.0       0.0      -1.8
 1    17.19     500.1      -7.0       0.0       0.0      -7.0
 2    17.19     664.2      -8.3       0.0       0.0      -8.3
 3    17.19     829.5     -11.0       0.0       0.0     -11.0
 4    17.19    1030.5     -15.1       0.0       0.0     -15.1
 5    17.19    1273.3     -21.4       0.0       0.0     -21.4
 6    17.19    1596.8     -28.9       0.0       0.0     -28.9
 7    17.19    2044.5     -38.9       0.0       0.0     -38.9
 8    17.19    2821.3     -62.9       0.0       0.0     -62.9
 9    17.19    6369.3     -87.0       0.0       0.0     -87.0
 A   171.93   17325.2    -282.4       0.0       0.0    -282.4
</pre></div>
</div>
<p>This produces 2022 output for the filing units in the <code class="docutils literal notranslate"><span class="pre">cps.csv</span></code> file using the policy reform specified in the <code class="docutils literal notranslate"><span class="pre">ref3.json</span></code> file. Notice that Taxcalc-Payroll knows to extrapolate (or “age”) filing unit data in the <code class="docutils literal notranslate"><span class="pre">cps.csv</span></code> file to the specified tax year.
It knows to do that because of the special input file name <code class="docutils literal notranslate"><span class="pre">cps.csv</span></code>.
The tables produced by this analysis are written to the <code class="docutils literal notranslate"><span class="pre">cps-22-#-ref3-#-tab.text</span></code> file.
Note that on Windows you would use <code class="docutils literal notranslate"><span class="pre">dir</span></code> instead of <code class="docutils literal notranslate"><span class="pre">ls</span></code> and <code class="docutils literal notranslate"><span class="pre">type</span></code> instead of <code class="docutils literal notranslate"><span class="pre">cat</span></code>.</p>
<p>Also note that the tables above in example (7) include in the bottom decile some filing units who have negative or zero expanded income in the baseline. If you want tables that somehow exclude those filing units, use the <code class="docutils literal notranslate"><span class="pre">--dump</span></code> option and tabulate your own tables.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcp cps.csv 2024 --reform ref3.json --graphs
You loaded data for 2014.
Taxcalc-Payroll startup automatically extrapolated your data to 2024.

$ ls cps-24-*
cps-24-#-ref3-#-atr.html    cps-24-#-ref3-#-pch.html
cps-24-#-ref3-#-doc.text    cps-24-#-ref3-#.csv
cps-24-#-ref3-#-mtr.html
</pre></div>
</div>
<p>This example is like the previous one, except we ask for 2024 static output and for graphs instead of tables, although we could ask for both.
The HTML files containing the graphs can be viewed in your browser.</p>
<p>Here is what the average tax rate graph in <code class="docutils literal notranslate"><span class="pre">cps-24-#-ref3-#-atr.html</span></code> looks like.</p>
<p><img alt="atr graph" src="_static/atr.png" /></p>
<p>Here is what the marginal tax rate graph in <code class="docutils literal notranslate"><span class="pre">cps-24-#-ref3-#-mtr.html</span></code> looks like:</p>
<p><img alt="mtr graph" src="_static/mtr.png" /></p>
<p>Here is what the percentage change in aftertax income graph in <code class="docutils literal notranslate"><span class="pre">cps-24-#-ref3-#-pch.html</span></code> looks like:</p>
<p><img alt="pch graph" src="_static/pch.png" /></p>
<p>There is yet another <code class="docutils literal notranslate"><span class="pre">tcp</span></code> output option that writes to the screen results from a normative welfare analysis of the specified policy reform. This <code class="docutils literal notranslate"><span class="pre">--ceeu</span></code> option produces experimental results that make sense only with input files that contain representative samples of the population such as the <code class="docutils literal notranslate"><span class="pre">cps.csv</span></code> file. The name of this option stands for certainty-equivalent expected utility. If you want to use this output option, you should read the commented Python source code for the <code class="docutils literal notranslate"><span class="pre">ce_aftertax_expanded_income</span></code> function in the <code class="docutils literal notranslate"><span class="pre">taxcalc/utils.py</span></code> file in the <a class="reference external" href="https://github.com/PSLmodels/Tax-Calculator">Tax-Calculator repository</a>.</p>
<p>None of the above examples use the <code class="docutils literal notranslate"><span class="pre">--baseline</span></code> option, which means that baseline policy in those examples is current-law policy. The following example shows how to use the <code class="docutils literal notranslate"><span class="pre">--baseline</span></code> option to engage in counter-factual historical analysis. Suppose we want to analyze what would have happened if some alternative to TCJA had been enacted in late 2017. To do this we need to have pre-TCJA policy be the baseline policy and we need to have the alternative reform be implemented relative to pre-TCJA policy. The following <code class="docutils literal notranslate"><span class="pre">tcp</span></code> run does exactly that using a local copy of the <a class="reference external" href="https://github.com/bodiyang/Taxcalc-Payroll/blob/master/taxcalcpayroll/reforms/2017_law.json">2017_law.json</a> <a>file and the <code class="docutils literal notranslate"><span class="pre">alt_reform.json</span></code> file containing the alternative reform defined relative to pre-TCJA law.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcp cps.csv 2019 --baseline 2017_law.json --reform 2017_law.json+alt_reform.json
You loaded data for 2014.
Taxcalc-Payroll startup automatically extrapolated your data to 2019.
</pre></div>
</div>
<p>In all the examples in this section, we have executed one <code class="docutils literal notranslate"><span class="pre">tcp</span></code> run at at time.
But <strong>what if you want to execute many <code class="docutils literal notranslate"><span class="pre">tcp</span></code> runs</strong> because you want results for many years and/or for several different reforms.
Unless you are asking for full-dump output, a single <code class="docutils literal notranslate"><span class="pre">tcp</span></code> run should take no more than one minute on your computer (even if you are using the large <code class="docutils literal notranslate"><span class="pre">cps.csv</span></code> input file).
The easiest way to speed up the execution of many <code class="docutils literal notranslate"><span class="pre">tcp</span></code> runs is to split them into groups of runs and execute each group of runs in a different command-prompt window.
On most modern computers that have four CPU cores and a fast disk drive, executing four runs in different windows will take not much more time than executing a single <code class="docutils literal notranslate"><span class="pre">tcp</span></code> run.
If you have more than one run in each group, put them in a Unix/Mac bash script or a Windows batch file, and execute one script in each command-prompt window.
If it still takes too long, consider splitting the <code class="docutils literal notranslate"><span class="pre">tcp</span></code> runs across more than one computer.</p>
</section>
<section id="tabulate-reform-results">
<h2>Tabulate reform results<a class="headerlink" href="#tabulate-reform-results" title="Permalink to this heading">#</a></h2>
<p>Given that <code class="docutils literal notranslate"><span class="pre">tcp</span></code> output can be written to either CSV-formatted files or SQLite3 database files, there is an enormous range of software tools that can be used to tabulate the output. You can use SAS or R, Stata or MATLAB, or even import output into a spreadsheet (but this would seem to be the least useful option). If you just want to compare the contents of two output files, you can use your favorite graphical diff program to view the two files <q>side by side</q> with highlighting of numbers that are different. The main point is to use a software tool that is available to you, that is appropriate for the task, and that you have experience using.</p>
<p>Here we give some examples of using the <code class="docutils literal notranslate"><span class="pre">sqlite3</span></code> command-line tool that is part of the Anaconda distribution (so it is always available when using Taxcalc-Payroll). The first step, of course, is to use the <code class="docutils literal notranslate"><span class="pre">--sqldb</span></code> option when running <code class="docutils literal notranslate"><span class="pre">tcp</span></code>. Then you can use the <code class="docutils literal notranslate"><span class="pre">sqlite3</span></code> tool interactively or use it to execute SQL scripts you have saved in a text file. We’ll provide examples of both those approaches. There are many online tutorials on the SQL select command; if you want to learn more, search the Internet.</p>
<p>First, we provide a simple example of using <code class="docutils literal notranslate"><span class="pre">sqlite3</span></code> interactively.
This approach is ideal for exploratory data analysis.
Our example uses the <code class="docutils literal notranslate"><span class="pre">cps.csv</span></code> file as input, but you can do the following with
the output from any input file that has weights (<code class="docutils literal notranslate"><span class="pre">s006</span></code>).
Also, we specify no policy reform file, so the output is for current-law policy.
What you cannot see from the following record of the analysis is that the
<code class="docutils literal notranslate"><span class="pre">sqlite3</span></code> tool keeps a command history, so pressing the up-arrow key will bring
up the prior command for editing.
This feature reduces substantially the amount of typing required to conduct
exploratory data analysis.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tcp cps.csv 2016 --sqldb
You loaded data for 2014.
Taxcalc-Payroll startup automatically extrapolated your data to 2016.

$ sqlite3 cps-16-#-#-#.db
SQLite version 3.22.0 2018-01-22 18:45:57
Enter &quot;.help&quot; for usage hints.
sqlite&gt; YOUR FIRST SQL COMMAND GOES HERE
sqlite&gt; YOUR SECOND SQL COMMAND GOES HERE
sqlite&gt; ...
sqlite&gt; YOUR FINAL SQL COMMAND GOES HERE
sqlite&gt; .quit
</pre></div>
</div>
<p>Second, we provide a simple example of using <code class="docutils literal notranslate"><span class="pre">sqlite3</span></code> with SQL commands stored
in a text file.
This approach is useful if you want to tabulate many different output files in
the same way.
This second example assumes that the first example has already been done.
Note that on Windows you should replace <code class="docutils literal notranslate"><span class="pre">cat</span></code> with <code class="docutils literal notranslate"><span class="pre">type</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat tab.sql
-- tabulate unweighted and weighted number of filing units
select &quot;unweighted count | weighted count (#m) of filing units&quot;;
select count(*),  -- unweighted count of filing units
       round(sum(s006)*1e-6,3) -- weighted count of filing units (#m)
from dump;

-- weighted count by filing status (MARS)
select &quot;filing status (MARS) | weighted count of filing units&quot;;
select MARS, -- filing status
       round(sum(s006)*1e-6,3) -- weighted count of filing units (#m)
from dump
group by MARS;

-- tabulate weight of those with NEGATIVE marginal income tax rates
select &quot;weighted count of those with NEGATIVE MTR&quot;;
select round(sum(s006)*1e-6,3) -- weighted count of filing units (#m)
from dump
where mtr_inctax &lt; 0;

-- construct NON-NEGATIVE marginal income tax rate histogram with bin width 10
select &quot;bin number | weighted count | mean NON-NEGATIVE MTR in bin&quot;;
select cast(round((mtr_inctax-5)/10) as int) as mtr_bin, -- histogram bin number
       round(sum(s006)*1e-6,3), -- weight count of filing units in bin (#m)
       -- weighted mean marginal income tax rate on taxpayer earnings in bin:
       round(sum(mtr_inctax*s006)/sum(s006),2)
from dump
where mtr_inctax &gt;= 0 -- include only those with NON-NEGATIVE marginal tax rate
group by mtr_bin
order by mtr_bin;

$ cat tab.sql | sqlite3 cps-16-#-#-#.db
unweighted count | weighted count (#m) of filing units
456465|157.558
filing status (MARS) | weighted count of filing units
1|81.303
2|61.655
4|14.599
weighted count of those with NEGATIVE MTR
15.473
bin number | weighted count | mean NON-NEGATIVE MTR in bin
-1|26.896|0.0
0|2.606|7.18
1|60.85|14.11
2|37.803|25.54
3|12.804|32.26
4|1.0|43.08
5|0.11|55.74
6|0.015|66.76
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">cat</span></code> command writes the contents of the <code class="docutils literal notranslate"><span class="pre">tab.sql</span></code> file to stdout.
We do nothing but that in the first command in order to show you the file
contents.
The second command pipes the contents of the <code class="docutils literal notranslate"><span class="pre">tab.sql</span></code> file into the <code class="docutils literal notranslate"><span class="pre">sqlite3</span></code>
tool, which executes the SQL statements and writes the tabulation results to
stdout.
(If you’re wondering about the validity of those high marginal tax rates,
rest assured that all filing units with marginal income tax rates greater than
sixty percent have been checked by hand and are valid:
most are caught in the rapid phase-out of non-refundable education credits or
in the phase-in of taxation of social security benefits.
The negative marginal tax rates are caused by refundable credits,
primarily the earned income tax credit.)</p>
<p>If you want to use the <code class="docutils literal notranslate"><span class="pre">sqlite3</span></code> tool to tabulate the changes caused by a
reform, use <code class="docutils literal notranslate"><span class="pre">tcp</span></code> to generate two database dump files
(one for current-law policy and the other for your reform)
and then use the SQLite3 ATTACH command to make both database files available
in your SQLite tabulation session.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./guide"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="python_interface.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Python interface</p>
      </div>
    </a>
    <a class="right-next"
       href="policy_params.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Policy parameters</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-tcp-cli">Test <code class="docutils literal notranslate"><span class="pre">tcp</span></code> CLI</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specify-tax-reform">Specify tax reform</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specify-analysis-assumptions">Specify analysis assumptions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specify-filing-units">Specify filing units</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initiate-reform-analysis">Initiate reform analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tabulate-reform-results">Tabulate reform results</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Bodi Yang
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>